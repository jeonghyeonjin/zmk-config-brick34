#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
#include <dt-bindings/zmk/outputs.h>
#include <dt-bindings/zmk/mouse.h>
#ifdef EXTERNAL_POWER
#    include <dt-bindings/zmk/ext_power.h>
#endif

// Layer definitions
    #define BASE 0
    #define NUM 1
    #define SYM 2
	#define PAD 3
    #define FNC 4
// -----------------

// Desktop and tab navigation shortcuts
#define D_LT   LC(LG(LEFT))
#define D_RT   LC(LG(RIGHT))
#define TAB_RT LC(TAB)
#define TAB_LT LC(LS(TAB))


// Key position groups
#define KEYS_L 0 1 2 3 4 10 11 12 13 14 20 21 22 23 24
#define KEYS_R 5 6 7 8 9 15 16 17 18 19 25 26 27 28 29
#define THUMBS 30 31 32 33
// -----------------

#define QUICK_TAP_MS 175

#include "combos.dtsi"
#include "mouse.dtsi"

&mt {
  quick-tap-ms = <80>;
//   global-quick-tap;
  flavor = "balanced";
  tapping-term-ms = <150>;
};

&sk {
		// don't release mods on other mods presses
    ignore-modifiers;
};

&lt {  // layer-tap config
    flavor = "balanced";
    tapping-term-ms = <200>;
    quick-tap-ms = <QUICK_TAP_MS>;
};

/ {
	behaviors {
        aml: alpha_mods_l {
            compatible = "zmk,behavior-hold-tap";
            label = "ALPHA_MT_L";
            #binding-cells = <2>;
            tapping-term-ms = <280>;
            quick-tap-ms = <175>;
            flavor = "balanced";
            bindings = <&kp>, <&kp>;
            hold-trigger-key-positions = <KEYS_R THUMBS>;
            // hold-trigger-on-release;
        };
        asl: alpha_shift_l {
            compatible = "zmk,behavior-hold-tap";
            label = "ALPHA_SFT_L";
            #binding-cells = <2>;
            tapping-term-ms = <280>;
            quick-tap-ms = <175>;
            flavor = "balanced";
            bindings = <&kp>, <&kp>;
            hold-trigger-key-positions = <KEYS_R THUMBS>;
            // hold-trigger-on-release;
        };
        amr: alpha_mods_r {
            compatible = "zmk,behavior-hold-tap";
            label = "ALPHA_MT_R";
            #binding-cells = <2>;
            tapping-term-ms = <280>;
            quick-tap-ms = <175>;
            flavor = "balanced";
            bindings = <&kp>, <&kp>;
            hold-trigger-key-positions = <KEYS_L THUMBS>;
            // hold-trigger-on-release;
        };
        asr: alpha_shift_r {
            compatible = "zmk,behavior-hold-tap";
            label = "ALPHA_SFT_R";
            #binding-cells = <2>;
            tapping-term-ms = <280>;
            quick-tap-ms = <175>;
            flavor = "balanced";
            bindings = <&kp>, <&kp>;
            hold-trigger-key-positions = <KEYS_L THUMBS>;
            // hold-trigger-on-release;
        };
        bhm: balanced_homerow_mods {
            compatible = "zmk,behavior-hold-tap";
            label = "HomerowHoldtap";
            #binding-cells = <2>;
            tapping-term-ms = <200>;    // <---[[moderate duration]]
            quick-tap-ms = <0>;
            flavor = "balanced";
            bindings = <&kp>, <&kp>;
        };
    };
		
	macros {
		// sometimes my device thinks a modifier is being held down
		// pressing all modifiers fixes it.
		unstick: unstick {
			label = "ZM_unstick";
			compatible = "zmk,behavior-macro";
			#binding-cells = <0>;
			bindings = <&kp LSHIFT &kp RSHIFT &kp LCTRL &kp RCTRL &kp LALT &kp RALT &kp LGUI &kp RGUI>;
		};
	};
	keymap {
		compatible = "zmk,keymap";

		default_layer {
			label = "BASE";
            bindings = <
// ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮   ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮
   	&kp Q            &kp W            &kp E            &kp R            &kp T                &kp Y       	  &kp U            &kp I       		&kp O       	 &kp P
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
   	&bhm LSHFT A     &bhm LALT S      &bhm LGUI D      &kp F            &kp G                &kp H       	  &kp J            &bhm LGUI K  	&bhm LALT L  	 &bhm RSHFT SEMI
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
   	&bhm LCTRL Z     &kp X            &kp C            &kp V            &kp B                &kp N       	  &mt MINUS M      &mt EQUAL COMMA  &mt EXCL DOT	 &bhm RCTRL FSLH
// ╰────────────────┴────────────────┴────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┴────────────────┴────────────────╯
                                              		   &lt PAD TAB      &lt SYM SPACE        &lt NUM RET 	  &kp BSPC
//                                                    ╰────────────d────┴────────────────╯   ╰────────────────┴────────────────╯
            >;
		};
        lower_layer {
			label = "NUM";
            bindings = <
// ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮   ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮
    &kp N1		     &kp N2		      &kp N3		   &kp N4		    &kp N5		    	 &kp N6	    	  &kp N7		   &kp N8			&kp N9			 &kp N0
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
    &trans 		 	 &kp TAB_LT	  	  &kp TAB_RT       &trans   	    &kp INS       		 &kp HOME		  &kp LEFT		   &kp UP  		    &kp RIGHT		 &kp PG_UP
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
    &trans 		 	 &kp C_VOL_UP	  &kp C_VOL_DN	   &kp C_PP 	    &trans        		 &kp END	      &trans	       &kp DOWN		    &trans	    	 &kp PG_DN
// ╰────────────────┴────────────────┴────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┴────────────────┴────────────────╯
               	                                       &trans           &mo FNC         	 &trans      	  &kp DEL
//                                                    ╰────────────────┴────────────────╯   ╰────────────────┴────────────────╯
            >;
		};
		raise_layer {
			label = "SYM";
			bindings = <
// ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮   ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮
    &kp EXCL  	     &kp AT 		  &kp HASH  	   &kp DLLR  	    &kp PRCNT       	 &kp CARET		  &kp AMPS		   &kp ASTRK		&kp LPAR		 &kp RPAR
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
    &sk LALT	     &sk LGUI	      &sk LSHIFT	   &sk LCTRL	    &sk RALT 	    	 &kp MINUS 		  &kp EQUAL		   &kp BSLH		    &kp LBRC   		 &bhm RSHFT RBRC
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
    &kp PRINTSCREEN  &trans 		  &trans  		   &kp GRAVE    	&kp TILDE 			 &kp UNDER		  &kp PLUS		   &kp PIPE		    &kp LBKT 		 &bhm RCTRL RBKT
// ╰────────────────┴────────────────┴────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┴────────────────┴────────────────╯
        	                                           &trans           &trans          	 &mo FNC     	  &kp DEL
//                                                    ╰────────────────┴────────────────╯   ╰────────────────┴────────────────╯
            >;
		};
		pad_layer {
			label = "PAD";
			bindings = <
// ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮   ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮
    &kp ESC	         &kp N7	          &kp N8		   &kp N9	        &kp MINUS       	 &none            &none            &none 	        &none 	         &none
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
    &mt LSHIFT TAB	 &kp N4	          &kp N5		   &kp N6	        &kp DOT 	    	 &none       	  U_MS_L           U_MS_U 	        U_MS_R           &none
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
    &kp N0     		 &kp N1    	 	  &kp N2 		   &kp N3   		&kp EQUAL  	   		 &none         	  U_WH_D           U_MS_D           U_WH_U           &none
// ╰────────────────┴────────────────┴────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┴────────────────┴────────────────╯
        	                                           &trans           &trans          	 U_BTN1     	  U_BTN2
//                                                 	  ╰────────────────┴────────────────╯   ╰────────────────┴────────────────╯
            >;
		};
        fuc_layer {
			label = "Func";
            bindings = <
// ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮   ╭────────────────┬────────────────┬────────────────┬────────────────┬────────────────╮
    &kp F9	         &kp F10	      &kp F11		   &kp F12	        &none          		 &none			  &none			   &none			&none     		 &none
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
    &kp F5	         &kp F6	          &kp F7		   &kp F8	        &none 	        	 &bt BT_SEL 0     &bt BT_SEL 1     &bt BT_SEL 2 	&bt BT_SEL 3   	 &bt BT_CLR
// ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┼────────────────┼────────────────┤
    &kp F1     		 &kp F2    		  &kp F3 		   &kp F4   		&none 	    		 &none	    	  &none	   		   &none  	    	&unstick 		 &bootloader
// ╰────────────────┴────────────────┴────────────────┼────────────────┼────────────────┤   ├────────────────┼────────────────┼────────────────┴────────────────┴────────────────╯
        	                                           &trans           &trans          	 &trans      	  &trans
//                                                 	  ╰────────────────┴────────────────╯   ╰────────────────┴────────────────╯
            >;
		};
    };
};
